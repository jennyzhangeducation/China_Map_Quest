<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å›½åœ°ç†é—¯å…³ï¼šçœä»½ç®€ç§°</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- æ ·å¼éƒ¨åˆ†ä¿æŒä¸å˜ï¼Œç¾è§‚å¤§æ–¹ --- */
        :root {
            --primary: #3498db;
            --success: #67C23A; /* é²œè‰³çš„ç»¿è‰² */
            --bg-color: #f0f3f8;
            --card-bg: #ffffff;
            --text-dark: #2c3e50;
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Noto Sans SC', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-color);
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center; z-index: 10;
        }
        
        header h1 { margin: 0; font-size: 24px; letter-spacing: 1px; }
        header .sub-text { font-size: 14px; opacity: 0.8; }

        .main-container { display: flex; flex: 1; position: relative; }

        .side-panel {
            width: 300px; background: var(--card-bg); padding: 25px;
            box-shadow: 2px 0 15px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; z-index: 5;
        }

        .score-box {
            text-align: center; background: #f8f9fa; border-radius: 15px; padding: 20px; border: 1px solid #e9ecef;
        }

        .score-num { font-size: 48px; font-weight: bold; color: var(--primary); line-height: 1; }
        
        .progress-track {
            height: 10px; background: #e0e0e0; border-radius: 5px; margin-top: 15px; overflow: hidden;
        }
        .progress-fill { height: 100%; width: 0%; background: var(--success); transition: width 0.4s ease; }

        .instructions {
            margin-top: 30px; background: #fff8e1; border-left: 5px solid #ffca28;
            padding: 15px; font-size: 14px; color: #5d4037; line-height: 1.6; border-radius: 4px;
        }

        #map-chart { flex: 1; background: #eef2f5; }

        .modal-mask {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(3px);
            display: none; justify-content: center; align-items: center; z-index: 999;
        }

        .game-card {
            background: white; width: 340px; padding: 30px; border-radius: 20px;
            text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .province-title { font-size: 28px; color: var(--text-dark); margin: 0 0 10px 0; }
        .question-text { color: #7f8c8d; margin-bottom: 25px; }

        .answer-input {
            width: 200px; padding: 12px; font-size: 20px; text-align: center;
            border: 2px solid #dfe6e9; border-radius: 10px; outline: none; transition: all 0.3s;
        }

        .answer-input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1); }

        .btn-submit {
            margin-top: 25px; background: var(--primary); color: white; border: none;
            padding: 12px 40px; font-size: 16px; border-radius: 50px; cursor: pointer;
            transition: transform 0.1s;
        }
        .btn-submit:active { transform: scale(0.95); }

        .feedback { height: 20px; margin-top: 15px; font-weight: bold; font-size: 14px; }
        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0% { transform: translateX(0); } 25% { transform: translateX(-10px); } 50% { transform: translateX(10px); } 75% { transform: translateX(-10px); } 100% { transform: translateX(0); }
        }
    </style>
</head>
<body>

    <header>
        <h1>ğŸ‡¨ğŸ‡³ ä¸­å›½åœ°ç†é—¯å…³</h1>
        <span class="sub-text">åˆä¸­åœ°ç†å¤ä¹ ä¸“ç”¨</span>
    </header>

    <div class="main-container">
        <aside class="side-panel">
            <div class="score-box">
                <div class="score-title">å½“å‰å¾—åˆ†</div>
                <div class="score-num"><span id="current-score">0</span> / 34</div>
                <div class="progress-track">
                    <div class="progress-fill" id="progress-bar"></div>
                </div>
            </div>
            <div class="instructions">
                <strong>ğŸ® ç©æ³•è¯´æ˜ï¼š</strong>
                <p>1. ç‚¹å‡»åœ°å›¾ä¸Šç™½è‰²çš„çœä»½ã€‚<br>
                2. è¾“å…¥å®ƒçš„<b>ç®€ç§°</b>ï¼ˆå¦‚â€œäº¬â€ï¼‰ã€‚<br>
                3. <span style="color:var(--success); font-weight:bold;">ç­”å¯¹ååœ°å›¾ä¼šå˜ç»¿</span>ï¼Œè¯•è¯•çœ‹ï¼</p>
            </div>
        </aside>
        <div id="map-chart"></div>
    </div>

    <div class="modal-mask" id="quiz-modal">
        <div class="game-card">
            <h2 class="province-title" id="modal-title">åŒ—äº¬å¸‚</h2>
            <div class="question-text">è¯·å¡«å†™è¯¥çœä»½/åŸå¸‚çš„ç®€ç§°</div>
            <input type="text" class="answer-input" id="user-input" maxlength="4" autocomplete="off">
            <div class="feedback" id="feedback-msg"></div>
            <button class="btn-submit" onclick="submitAnswer()">ç¡®å®š</button>
        </div>
    </div>

    <script>
        // 1. æ•°æ®é…ç½®
        const provinceDatabase = {
            "åŒ—äº¬å¸‚": ["äº¬"], "å¤©æ´¥å¸‚": ["æ´¥"], "æ²³åŒ—çœ": ["å†€"], "å±±è¥¿çœ": ["æ™‹"],
            "å†…è’™å¤è‡ªæ²»åŒº": ["å†…è’™å¤"], "è¾½å®çœ": ["è¾½"], "å‰æ—çœ": ["å‰"], "é»‘é¾™æ±Ÿçœ": ["é»‘"],
            "ä¸Šæµ·å¸‚": ["æ²ª"], "æ±Ÿè‹çœ": ["è‹"], "æµ™æ±Ÿçœ": ["æµ™"], "å®‰å¾½çœ": ["çš–"],
            "ç¦å»ºçœ": ["é—½"], "æ±Ÿè¥¿çœ": ["èµ£"], "å±±ä¸œçœ": ["é²"], "æ²³å—çœ": ["è±«"],
            "æ¹–åŒ—çœ": ["é„‚"], "æ¹–å—çœ": ["æ¹˜"], "å¹¿ä¸œçœ": ["ç²¤"], "å¹¿è¥¿å£®æ—è‡ªæ²»åŒº": ["æ¡‚"],
            "æµ·å—çœ": ["ç¼"], "é‡åº†å¸‚": ["æ¸"], "å››å·çœ": ["å·", "èœ€"], "è´µå·çœ": ["è´µ", "é»”"],
            "äº‘å—çœ": ["äº‘", "æ»‡"], "è¥¿è—è‡ªæ²»åŒº": ["è—"], "é™•è¥¿çœ": ["é™•", "ç§¦"],
            "ç”˜è‚ƒçœ": ["ç”˜", "é™‡"], "é’æµ·çœ": ["é’"], "å®å¤å›æ—è‡ªæ²»åŒº": ["å®"],
            "æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº": ["æ–°"], "å°æ¹¾çœ": ["å°"], "é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº": ["æ¸¯"], "æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº": ["æ¾³"]
        };

        let solvedProvinces = []; // å­˜æ”¾å·²ç­”å¯¹çš„çœä»½æ•°æ®
        let currentProvince = null;
        let score = 0;
        const totalCount = 34;

        const myChart = echarts.init(document.getElementById('map-chart'));

        // 2. åŠ è½½åœ°å›¾
        $.get('https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json', function (geoJson) {
            
            echarts.registerMap('china', geoJson);

            // ã€å…³é”®ä¿®æ”¹ã€‘ï¼šåªä½¿ç”¨ series é…ç½®åœ°å›¾ï¼Œä¸å†ä½¿ç”¨ geoï¼Œé¿å…å±‚çº§é®æŒ¡é—®é¢˜
            renderMap(); 

            // ç›‘å¬ç‚¹å‡»
            myChart.on('click', function (params) {
                const name = params.name;
                if (!provinceDatabase[name]) return;

                // æ£€æŸ¥æ˜¯å¦å·²ç­”å¯¹ (é€šè¿‡ name æŸ¥æ‰¾)
                const isSolved = solvedProvinces.some(p => p.name === name);
                if (isSolved) {
                    alert(name + " å·²ç»å›ç­”æ­£ç¡®å•¦ï¼");
                    return;
                }
                openModal(name);
            });
        });

        // å°è£…æ¸²æŸ“å‡½æ•°ï¼Œç¡®ä¿æ¯æ¬¡éƒ½èƒ½å½»åº•é‡ç»˜
        function renderMap() {
            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}'
                },
                series: [{
                    name: 'ä¸­å›½åœ°å›¾',
                    type: 'map',
                    map: 'china',
                    roam: true,
                    zoom: 1.2,
                    label: {
                        show: true,
                        color: '#666',
                        fontSize: 10
                    },
                    itemStyle: {
                        areaColor: '#ffffff', // é»˜è®¤ç™½è‰²
                        borderColor: '#bdc3c7',
                        borderWidth: 1,
                        shadowColor: 'rgba(0, 0, 0, 0.1)',
                        shadowBlur: 10
                    },
                    emphasis: {
                        label: { color: '#fff' },
                        itemStyle: { areaColor: '#3498db' } // é¼ æ ‡æ‚¬æµ®è“
                    },
                    select: { disabled: true },
                    
                    // ã€å…³é”®ç‚¹ã€‘ï¼šè¿™é‡Œç»‘å®šæ•°æ®ï¼Œdata ä¸­çš„ itemStyle ä¼˜å…ˆçº§æœ€é«˜
                    data: solvedProvinces 
                }]
            };
            // setOption æ—¶åŠ ä¸Š notMerge: false å“ªæ€•å¼ºåˆ¶é‡ç»˜ä¹Ÿè¦ä¿è¯é¢œè‰²æ›´æ–°
            myChart.setOption(option);
        }

        // 3. äº¤äº’é€»è¾‘
        const modal = document.getElementById('quiz-modal');
        const inputEl = document.getElementById('user-input');
        const titleEl = document.getElementById('modal-title');
        const feedbackEl = document.getElementById('feedback-msg');

        function openModal(name) {
            currentProvince = name;
            titleEl.innerText = name;
            inputEl.value = '';
            feedbackEl.innerText = '';
            inputEl.classList.remove('shake');
            modal.style.display = 'flex';
            setTimeout(() => inputEl.focus(), 100);
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        function submitAnswer() {
            const val = inputEl.value.trim();
            if (!val) return;

            const correctAnswers = provinceDatabase[currentProvince];

            if (correctAnswers.includes(val)) {
                // --- ç­”å¯¹ ---
                feedbackEl.style.color = 'var(--success)';
                feedbackEl.innerText = 'âœ… å›ç­”æ­£ç¡®ï¼';

                // 1. æ¨å…¥æ•°æ®ï¼Œæ˜¾å¼æŒ‡å®šé¢œè‰²
                solvedProvinces.push({
                    name: currentProvince,
                    selected: true, // è¾…åŠ©å±æ€§
                    itemStyle: {
                        areaColor: '#67C23A', // ã€å¼ºåˆ¶å˜ç»¿ã€‘
                        borderColor: '#fff'
                    },
                    label: {
                        show: true,
                        color: '#fff',
                        fontWeight: 'bold'
                    }
                });

                // 2. è°ƒç”¨æ¸²æŸ“å‡½æ•°ï¼Œæ›´æ–°åœ°å›¾
                renderMap();

                // 3. æ›´æ–°åˆ†æ•°
                score++;
                document.getElementById('current-score').innerText = score;
                document.getElementById('progress-bar').style.width = (score / totalCount * 100) + '%';

                setTimeout(closeModal, 600);

            } else {
                // --- ç­”é”™ ---
                feedbackEl.style.color = '#ff4757';
                feedbackEl.innerText = 'âŒ ç­”æ¡ˆä¸å¯¹';
                inputEl.classList.add('shake');
                setTimeout(() => inputEl.classList.remove('shake'), 500);
                inputEl.value = '';
                inputEl.focus();
            }
        }

        inputEl.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') submitAnswer();
        });

        modal.addEventListener('click', function (e) {
            if (e.target === modal) closeModal();
        });

        window.addEventListener('resize', () => myChart.resize());

    </script>
</body>
</html>
